<!-- Filtros de busca -->
<app-search-filters (resultadoBusca)="atualizarResultados($event)"></app-search-filters>

<!-- Resultado dos filtros -->
<div *ngIf="dadosFiltrados.length > 0; else semResultados">
  <div class="container">
    <div class="row-abaixo-titulo">
      <h1 class="titulo">Resultados da busca:</h1>
      <p>Exibindo resultados com base nos filtros aplicados.</p>
    </div>

    <div class="grid-container">
      <mat-card *ngFor="let pessoa of dadosFiltrados | slice:(paginaAtual * itensPorPagina):(paginaAtual * itensPorPagina + itensPorPagina)" class="card">
        <!-- Badge de status -->
        <div class="badge-status" 
             [ngClass]="{
               'localizado': pessoa.ultimoCorrencia?.encontradoVivo,
               'desaparecido': !pessoa.ultimoCorrencia?.encontradoVivo
             }">
          {{ pessoa.ultimoCorrencia?.encontradoVivo ? 'LOCALIZADO' : 'DESAPARECIDO' }}
        </div>

        <div class="imagem-container">
          <img mat-card-image [src]="pessoa.urlFoto || 'assets/imagem-padrao.svg'" 
               alt="Foto de {{ pessoa.nome || 'Desaparecido' }}">
        </div>

        <mat-card-content>
          <h2>{{ pessoa.nome || 'Nome não informado' }}</h2>
          <p *ngIf="pessoa.idade">Idade: {{ pessoa.idade }} anos</p>
          <p *ngIf="pessoa.sexo">Sexo: {{ pessoa.sexo | titlecase }}</p>
          <p *ngIf="pessoa.corOlhos">Cor dos Olhos: {{ pessoa.corOlhos }}</p>
          <p *ngIf="pessoa.corCabelos">Cor dos Cabelos: {{ pessoa.corCabelos }}</p>

          <p *ngIf="pessoa.ultimoCorrencia?.dibesaparecimento">
            Desaparecido em: {{ pessoa.ultimoCorrencia.dibesaparecimento | date:'dd/MM/yyyy' }}
          </p>

          <p *ngIf="pessoa.ultimoCorrencia?.localDesaparecimento">
            Último local visto: {{ pessoa.ultimoCorrencia.localDesaparecimento }}
          </p>

          <!-- Botão de detalhes -->
          <a mat-button color="primary" [routerLink]="['/detalhes', pessoa.id]">
            <mat-icon>search</mat-icon> Ver detalhes
          </a>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>

<!-- Quando não houver resultado filtrado -->
<ng-template #semResultados>
  <div class="container">
    <div class="row-abaixo-titulo">
      <h1 class="titulo">Pessoas desaparecidas em MT:</h1>
      <p>Exibindo todos os registros disponíveis.</p>
    </div>

    <div class="grid-container">
      <mat-card *ngFor="let desaparecido of desaparecidos | slice:(paginaAtual * itensPorPagina):(paginaAtual * itensPorPagina + itensPorPagina)" class="card">
        <!-- Badge de status -->
        <div class="badge-status" 
             [ngClass]="{
               'localizado': desaparecido.ultimoCorrencia?.encontradoVivo,
               'desaparecido': !desaparecido.ultimoCorrencia?.encontradoVivo
             }">
          {{ desaparecido.ultimoCorrencia?.encontradoVivo ? 'LOCALIZADO' : 'DESAPARECIDO' }}
        </div>

        <div class="imagem-container">
          <img mat-card-image [src]="desaparecido.urlFoto || 'assets/imagem-padrao.svg'" 
               alt="Foto de {{ desaparecido.nome || 'Desaparecido' }}">
        </div>

        <mat-card-content>
          <h2>{{ desaparecido.nome || 'Nome não informado' }}</h2>
          <p *ngIf="desaparecido.idade">Idade: {{ desaparecido.idade }} anos</p>
          <p *ngIf="desaparecido.sexo">Sexo: {{ desaparecido.sexo | titlecase }}</p>
          <p *ngIf="desaparecido.corOlhos">Cor dos Olhos: {{ desaparecido.corOlhos }}</p>
          <p *ngIf="desaparecido.corCabelos">Cor dos Cabelos: {{ desaparecido.corCabelos }}</p>

          <p *ngIf="desaparecido.ultimoCorrencia?.dibesaparecimento">
            Desaparecido em: {{ desaparecido.ultimoCorrencia.dibesaparecimento | date:'dd/MM/yyyy' }}
          </p>

          <p *ngIf="desaparecido.ultimoCorrencia?.localDesaparecimento">
            Último local visto: {{ desaparecido.ultimoCorrencia.localDesaparecimento }}
          </p>

          <!-- Botão de detalhes -->
          <a mat-button color="primary" [routerLink]="['/detalhes', desaparecido.id]">
            <mat-icon>search</mat-icon> Ver detalhes
          </a>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Caso não haja desaparecidos -->
    <div *ngIf="desaparecidos.length === 0" class="nenhum-encontrado">
      <p>Nenhuma pessoa desaparecida encontrada.</p>
    </div>
  </div>
</ng-template>

<!-- Controles de Paginação com Angular Material -->
<mat-paginator [length]="totalItens"
               [pageSize]="itensPorPagina"
               [pageSizeOptions]="[5, 10, 25, 100]"
               showFirstLastButtons
               (page)="onPaginaChange($event)">
</mat-paginator>
